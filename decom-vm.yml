---
 - name: Decommission VM on vCenter
   become: false
   hosts: localhost
   gather_facts: true

   vars:
     #decom_vm: 'rhel86-tpl'
     #staging_folder: /SDDC-Datacenter/vm/Workloads
     

   tasks: 
     - name: Gather all registered virtual machines
       community.vmware.vmware_vm_info:
         hostname: '{{ vcenter_hostname }}'
         username: '{{ vcenter_username }}'
         password: '{{ vcenter_password }}'
         show_tag: true
       delegate_to: localhost
       register: vminfo

     - name: Display all vms
       debug:
         msg: "{{ vminfo }}"

     - name: Set stage and delete dates as facts
       set_fact:
         stage_date: "{{ vminfo
         

     - name: Print age
       debug
       
     - name: Gather info on vm to decommission
       community.vmware.vmware_vm_info:
         hostname: '{{ vcenter_hostname }}'
         username: '{{ vcenter_username }}'
         password: '{{ vcenter_password }}'
         folder: '{{ staging_folder }}'
         vm_name: '{{ decom_vm }}'
         show_tag: true
       delegate_to: localhost
       register: vm_info

     - name: Display tags related to vm
       debug:
         msg: "{{ vm_info }}"

 


